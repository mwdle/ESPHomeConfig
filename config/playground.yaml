packages:
  - !include common/esp32.yaml
  - !include common/components/webserver.yaml

substitutions:
  device_name: esp-playground
  friendly_name: ESP Playground
  device_description: ESP32 Testing Device and Playground

output:
  - platform: ledc
    id: backlight_pwm
    pin: GPIO21
    frequency: 1000Hz

# 2. Create a "Light" entity that controls that output
light:
  - platform: monochromatic
    id: disp_backlight
    name: "Display Brightness"
    output: backlight_pwm
    default_transition_length: 0s
    restore_mode: ALWAYS_ON

# 1. Setup the SPI Bus (Shared by Display and Touch)
spi:
  clk_pin: GPIO18
  mosi_pin: GPIO23
  miso_pin: GPIO19

# 2. Configure the Hardware Display Driver
display:
  - platform: ili9xxx
    model: ILI9341
    id: my_hardware_display
    cs_pin: GPIO15
    dc_pin: GPIO2
    reset_pin: GPIO4
    rotation: 90 # Landscape mode (adjust to 0, 90, 180, 270)
    invert_colors: false
    # Note: No lambda here! LVGL takes over.

# 3. Configure the Touch Driver
touchscreen:
  - platform: xpt2046
    id: my_touch
    cs_pin: GPIO5
    interrupt_pin: GPIO22
    update_interval: 50ms
    # Calibration is often needed.
    # Check logs for "x=..." when touching corners to tune these.
    calibration:
      x_min: 200
      x_max: 3800
      y_min: 200
      y_max: 3800
    transform:
      swap_xy: true # Often needed for 90deg rotation

# 4. Fonts: Define standard text and Icon font
font:
  - file:
      url: "https://raw.githubusercontent.com/googlefonts/opensans/main/fonts/ttf/OpenSans-Regular.ttf"
      type: web
    id: opensans_12
    size: 12
    glyphs: "@%’&!¡\"\\'()+,-_.:°/$#€£¥?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyzÀàÁáÃãçÈèÉéẼẽÌìÍíÑñôÒòÓóÕõØøŚśÙùÚúŨũ"

  - file:
      url: "https://raw.githubusercontent.com/Templarian/MaterialDesign-Webfont/master/fonts/materialdesignicons-webfont.ttf"
      type: web
    id: mdi
    size: 24
    glyphs: [
        "󰖩", # wifi
        "󰖪", # wifi-off
        "󰃟", # brightness-6
        "󰀟", # cast-variant
        "󰋼", # information
      ]

# 5. LVGL: The UI Manager
lvgl:
  displays:
    - display_id: my_hardware_display
      buffer_size: 25% # bigger buffer = smoother animations

  touchscreens:
    - touchscreen_id: my_touch

  log_idle_timeout: 60s

  on_idle:
    - light.turn_off: disp_backlight

  on_interaction:
    - light.turn_on: disp_backlight

  # THE UI LAYOUT
  pages:
    - id: main_page
      widgets:
        # --- HEADER BAR (Flex Layout) ---
        - obj:
            height: 40
            width: 100%
            align: TOP_MID
            style:
              bg_color: 0x2196F3 # Blue
              radius: 0
              border_width: 0
            layout:
              type: FLEX
              flex_flow: ROW
              flex_align_main: SPACE_BETWEEN # Spreads items apart
              pad_all: 5
            widgets:
              # Left: Time
              - label:
                  text: "12:00 PM"
                  text_font: opensans_12
                  text_color: 0xFFFFFF
              # Right: WiFi Icon
              - label:
                  text: "\U000F05A9" # Wifi Icon
                  text_font: mdi
                  text_color: 0xFFFFFF

        # --- BODY CONTENT ---
        - obj:
            align: CENTER
            height: 150
            width: 280
            layout:
              type: FLEX
              flex_flow: COLUMN
              flex_align_main: CENTER
              flex_gap: 10
            style:
              border_width: 0
            widgets:
              - label:
                  text: "Living Room"
                  text_font: opensans_12
                  align: CENTER

              - button:
                  height: 60
                  width: 140
                  align: CENTER
                  on_click:
                    - logger.log: "Light Toggled!"
                    # - light.toggle: my_light
                  widgets:
                    - label:
                        text: "\U000F0335 Toggle"
                        text_font: mdi
                        align: CENTER
