packages:
  - !include common/esp32.yaml
  - !include common/components/webserver.yaml

substitutions:
  device_name: esp-playground
  friendly_name: ESP Playground
  device_description: ESP32 Testing Device and Playground

output:
  - platform: ledc
    id: backlight_pwm
    pin: GPIO21
    frequency: 1000Hz

# 2. Create a "Light" entity that controls that output
light:
  - platform: monochromatic
    id: disp_backlight
    name: "Display Brightness"
    output: backlight_pwm
    default_transition_length: 0s
    restore_mode: ALWAYS_ON

# 1. Setup the SPI Bus (Shared by Display and Touch)
spi:
  clk_pin: GPIO18
  mosi_pin: GPIO23
  miso_pin: GPIO19

# 2. Configure the Hardware Display Driver
display:
  - platform: ili9xxx
    model: ILI9341
    id: my_hardware_display
    cs_pin: GPIO15
    dc_pin: GPIO2
    reset_pin: GPIO4
    rotation: 90 # Landscape mode (adjust to 0, 90, 180, 270)
    invert_colors: false
    # Note: No lambda here! LVGL takes over.

# 3. Configure the Touch Driver
touchscreen:
  - platform: xpt2046
    id: my_touch
    cs_pin: GPIO5
    interrupt_pin: GPIO22
    update_interval: 50ms
    # Calibration is often needed.
    # Check logs for "x=..." when touching corners to tune these.
    calibration:
      x_min: 200
      x_max: 3800
      y_min: 200
      y_max: 3800
    transform:
      swap_xy: true # Often needed for 90deg rotation

# 4. Fonts: Define standard text and Icon font
font:
  - file:
      url: "https://raw.githubusercontent.com/googlefonts/opensans/main/fonts/ttf/OpenSans-Regular.ttf"
      type: web
    id: opensans_12
    size: 12
    glyphs: "@%’&!¡\"\\'()+,-_.:°/$#€£¥?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyzÀàÁáÃãçÈèÉéẼẽÌìÍíÑñôÒòÓóÕõØøŚśÙùÚúŨũ"

  - file:
      url: "https://raw.githubusercontent.com/Templarian/MaterialDesign-Webfont/master/fonts/materialdesignicons-webfont.ttf"
      type: web
    id: mdi
    size: 24
    glyphs: [
        "󰖩", # wifi
        "󰖪", # wifi-off
        "󰃟", # brightness-6
        "󰀟", # cast-variant
        "󰋼", # information
      ]

# 5. LVGL: The UI Manager
lvgl:
  buffer_size: 50%
  displays:
    - my_hardware_display
  touchscreens:
    - my_touch

  on_idle:
    timeout: 60s
    then:
      - light.turn_off: disp_backlight

  style_definitions:
    # 1. Header Container
    - id: style_header
      bg_color: 0x2196F3
      border_width: 0
      radius: 0
      height: 40
      width: 100%
      pad_all: 5

    # 2. White Text
    - id: style_text_white
      text_color: 0xFFFFFF

    # 3. Body Container
    - id: style_body
      width: 100%
      height: 100%
      border_width: 0
      pad_top: 20
      pad_row: 10

    # 4. Centered Text
    - id: style_text_center
      text_align: CENTER

    # 5. Button Container
    - id: style_btn
      bg_color: 0x4CAF50
      width: 140
      height: 60
      radius: 10

    # 6. Button Text
    - id: style_btn_label
      text_color: 0xFFFFFF
      text_align: CENTER

  pages:
    - id: main_page
      widgets:
        # --- HEADER ---
        - obj:
            id: header_bar
            layout:
              type: FLEX
              flex_flow: ROW
              flex_align_main: SPACE_BETWEEN
            styles: style_header

            widgets:
              - label:
                  text: "12:00 PM"
                  text_font: opensans_12
                  styles: style_text_white
              - label:
                  text: "󰖩"
                  text_font: mdi
                  styles: style_text_white

        # --- BODY ---
        - obj:
            layout:
              type: FLEX
              flex_flow: COLUMN
              flex_align_main: CENTER
            styles: style_body

            widgets:
              - label:
                  text: "Living Room"
                  text_font: opensans_12
                  styles: style_text_center

              - button:
                  id: toggle_btn
                  styles: style_btn
                  on_click:
                    - logger.log: "Button Clicked!"
                    - light.toggle: disp_backlight
                  widgets:
                    - label:
                        text: "󰃟 Toggle"
                        text_font: mdi
                        styles: style_btn_label
